---
doc_type: "agent_workflow"
id: "workflow"
version: "0.3"
last_updated: "2026-01-22"
status: "stable"
---

# Agentic Workflow（7フェーズ開発プロセス）

開発は以下の厳格なフェーズに分けて進行する。

---

## Phase 0: Prime（着手前の理解）

**目的**: 何を作るべきかを理解し、影響範囲を把握する。

### やること
- PRD・関連ドキュメント・現状コードの入口を読む（読み過ぎない）
- 依存関係・起動方法・テスト方法・CIの有無を確認
- 「今から触る領域」だけを特定し、影響範囲を仮説で書く

### 禁止事項
- この段階でコードの実装を開始してはならない

### セルフチェック
- [ ] 作業目的を1文で言える
- [ ] 成功条件（Acceptance Criteria）を言える
- [ ] 影響範囲（触る可能性のある場所）を列挙できる
- [ ] 検証方法（どうやって正しさを確認するか）を言える

---

## Phase 1: PRD（要件定義）

**目的**: 何を作るか・作らないかを明確にする。

### ルール
- PRDがない作業は「事故りやすい実験」。実験なら実験として明示する
- PRDは「機能単位（API、UI、Authなど）」に分割可能でなければならない

### PRDの最低要素
- 背景 / 課題
- ゴール（やる） / ノンゴール（やらない）
- ユースケース
- 要件（機能/非機能）
- 制約（技術・期限・互換性）
- 受け入れ条件（テスト観点でもOK）
- リスクと未確定事項

### セルフチェック
- [ ] ノンゴールが明確（スコープ膨張を止める栓がある）
- [ ] 受け入れ条件が「観測可能」（Yes/Noで判定できる）
- [ ] 未確定事項が列挙され、潰し方が書かれている

---

## Phase 2: Plan（実装計画）

**目的**: 実装前に計画を立て、Context Independent な作業手順を作成する。

### ルール
- Planは実装フェーズに持ち込む唯一の文脈になる
- Planは「TODO」ではなく「設計 + 作業手順 + 検証」のセット

### Planの最低要素
- 目的 / PRDリンク
- 変更方針（設計の要点）
- 影響範囲（ファイル・モジュール・API）
- 実装ステップ（順序つき）
- 検証ステップ（テスト、ビルド、手動確認）
- ロールバック/失敗時の戻し方
- 想定リスク（詰まりそうポイント）

### セルフチェック
- [ ] 実装ステップが順序つきで、各ステップが"小さい"
- [ ] 検証が具体（どのコマンド/どの観測でOKにするか）
- [ ] "やらないこと"がPlanにも反映されている
- [ ] 依存する外部要因（環境変数、APIキー等）が明記されている

---

## Phase 3: Context Reset（計画→実装の切替）

**目的**: 計画策定時の長い会話履歴を削除し、実行時の推論能力を最大化する。

### ルール
- ここで一度、会話の長い履歴・余計なログ・未整理の思考を捨てる
- 実装フェーズに持ち込むのは **Plan + 必要な参照doc** だけ

### セルフチェック
- [ ] 今から参照するのは「PLAN」だけ、と宣言した
- [ ] 追加で参照するdocがあるなら列挙した

---

## Phase 4: Implement（実装）

**目的**: 純粋なコンテキスト状態で、計画書に基づき高品質なコードを実装する。

### 事故防止の三種の神器
1. **小さく変更**（差分が説明できる粒度）
2. **局所性**（関係ない場所を触らない）
3. **可逆性**（戻せる・切り分けられる）

### 実装中の作法
- Planの指示に従い、コードを実装する
- 余計な推測はせず、計画書に記載された仕様を遵守する
- "推測で書いたコード"は、必ず検証ステップに紐づける
- 変更したら、何が壊れ得るかを短く書く（自分への地雷マップ）

### モジュラールール（Overwhelm防止）
タスクの種類に応じて、特定の参照ルールのみを読み込む：
- API開発時 → `docs/api/openapi/*.yaml` を参照
- セキュリティ関連 → `docs/security/*.md` を参照
- テスト設計 → `docs/test/*.md` を参照

### セルフチェック
- [ ] Planのステップ番号に沿って進んでいる
- [ ] 変更理由を説明できる
- [ ] 余計なリファクタでスコープを増やしていない
- [ ] "推測"の部分が検証項目に入っている

---

## Phase 5: Validate（検証）

**目的**: 実装が正しく動作することを確認する。

### ルール
- 失敗したら「テストが悪い」で逃げず、まず自分の変更を疑う
- 最低限、以下のどれか（理想は全部）：
  - 自動テスト
  - 静的解析（lint/typecheck）
  - ビルド
  - 手動確認（UI/主要API）

### セルフチェック
- [ ] PRDの受け入れ条件に対して検証結果を紐づけた
- [ ] 失敗時の切り分けログが残っている
- [ ] "通った/通ってない"が明確

---

## Phase 6: Report（実装レポート）

**目的**: 未来の自分/チームが最短で状況復元できるよう記録する。

### ルール
- レポートは「未来の自分/チームが最短で状況復元できる」ために書く
- 長文自慢は禁止。要点→根拠→次アクション

### セルフチェック
- [ ] 何を変えたか（概要）
- [ ] どこを変えたか（影響範囲）
- [ ] どう検証したか（結果つき）
- [ ] 残タスク/既知の制限（次にやること）

---

## Commandify（コマンド化のルール）

### いつコマンド化するか
- 2回以上使った定型プロンプト
- 毎回抜けやすいチェック（例：テスト実行・PR説明・レビュー観点）
- 新人に渡したい作業手順

### コマンドの品質基準
- 入力（前提）/ 出力（成果物）/ 手順 / Done条件 が明記されている
- "どの文脈でも使える最小形"にしておく（プロジェクト固有は参照docへ）

### 標準コマンド
- PRD承認ゲート: `bash scripts/prd-gate.sh`
- Evidence lint: `bash scripts/evidence-lint.sh`
- テスト一括: `bash scripts/test-all.sh`
- ADR作成: `bash scripts/new-adr.sh 0001 decision-slug`
- Context Reset: `bash scripts/context-reset.sh`
